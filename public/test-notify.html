<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Notification</title>
</head>
<body>
    <h1>Test Notification</h1>
    <button id="btn-request">Request Permission</button>
    <button id="btn-notify-api">Test standard Notification API</button>
    <button id="btn-notify-sw">Test ServiceWorker showNotification</button>
    <div id="log" style="font-family: monospace; white-space: pre-wrap; margin-top: 20px; padding: 10px; background: #eee;"></div>

    <script>
        function log(msg) {
            const p = document.createElement('div');
            p.textContent = `[${new Date().toISOString().split('T')[1].split('.')[0]}] ${msg}`;
            document.getElementById('log').prepend(p);
            console.log(msg);
        }

        document.getElementById('btn-request').addEventListener('click', async () => {
            log('Requesting permission...');
            try {
                const p = await Notification.requestPermission();
                log(`Permission result: ${p}`);
            } catch (e) {
                log(`Error requesting permission: ${e.message}`);
            }
        });

        document.getElementById('btn-notify-api').addEventListener('click', () => {
            log('Creating new Notification() object...');
            try {
                const n = new Notification("Test API", { body: "This is a test from the standard API" });
                n.onshow = () => log('Notification API: onshow event triggered!');
                n.onerror = (e) => log(`Notification API: onerror event triggered!`);
                n.onclose = () => log('Notification API: onclose event triggered');
            } catch (e) {
                log(`Error creating Notification API: ${e.message}`);
            }
        });

        document.getElementById('btn-notify-sw').addEventListener('click', async () => {
            log('Attempting to use ServiceWorker showNotification...');
            try {
                if (!navigator.serviceWorker) {
                    throw new Error("Service Worker not supported in this browser");
                }
                const reg = await navigator.serviceWorker.ready;
                if (!reg) {
                    throw new Error("No active Service Worker registration found");
                }
                log('Service worker is ready. Calling showNotification...');
                await reg.showNotification("Test SW", { body: "This is a test from the Service Worker API" });
                log('showNotification Promise resolved!');
            } catch (e) {
                log(`Error in ServiceWorker showNotification: ${e.message}`);
            }
        });
        
        // Check current permission on load
        log(`Initial Notification.permission: ${Notification.permission}`);
        if(navigator.serviceWorker) {
            navigator.serviceWorker.getRegistrations().then(regs => {
                log(`Found ${regs.length} active service worker registrations.`);
            });
        }
    </script>
</body>
</html>
